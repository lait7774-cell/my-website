<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartSpend | èŒå¯µ AI æ”¶æ”¯å„€è¡¨æ¿</title>
    <!-- å¼•å…¥ Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #d97706;
            --secondary: #fef3c7;
            --accent: #f472b6;
            --success: #10b981;
            --danger: #ef4444;
            --bg: #fffcf2;
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            color: #451a03;
        }

        .dashboard {
            max-width: 900px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(217, 119, 6, 0.1);
            border: 1px solid #fde68a;
        }

        .full-width { grid-column: 1 / -1; }

        .pet-container {
            width: 100px;
            height: 100px;
            background: #fff;
            border: 3px solid var(--primary);
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            position: relative;
        }

        .accessory {
            position: absolute;
            font-size: 1.5rem;
            display: none;
        }
        #acc-crown { top: -10px; right: -5px; }
        .unlocked { display: block !important; }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .summary-item {
            text-align: center;
            padding: 10px;
            background: #fffbeb;
            border-radius: 10px;
        }

        h2 { margin: 0 0 15px 0; font-size: 1.2rem; color: var(--primary); }

        .input-group { display: flex; flex-direction: column; gap: 10px; }
        input, select, button {
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #ddd;
            font-size: 1rem;
        }

        .btn-add { background: var(--primary); color: white; border: none; cursor: pointer; font-weight: bold; }
        .btn-ai { background: #334155; color: white; border: none; cursor: pointer; }

        .history-list { max-height: 200px; overflow-y: auto; margin-top: 10px; }
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        .val-income { color: var(--success); font-weight: bold; }
        .val-expense { color: var(--danger); font-weight: bold; }

        @media (max-width: 600px) { .dashboard { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="dashboard">
    <!-- é˜¿æŸ´åŠ©ç† -->
    <div class="card full-width" style="text-align: center;">
        <div class="pet-container">
            ğŸ• <span id="acc-crown" class="accessory">ğŸ‘‘</span>
        </div>
        <div style="font-weight: bold; margin-bottom: 15px;">æ±ªï¼æˆ‘æ˜¯é˜¿æŸ´ AI è¨˜å¸³åŠ©æ‰‹</div>
        <div class="input-group">
            <input type="text" id="ai-input" placeholder="ä¾‹å¦‚ï¼šæ™šé¤èŠ±äº† 150 å…ƒ">
            <button class="btn-ai" onclick="processAI()">æ±ªï¼è§£æ</button>
            <div id="ai-status" style="font-size: 0.8rem; color: #666;"></div>
        </div>
    </div>

    <!-- çµ±è¨ˆ -->
    <div class="card full-width">
        <div style="display: flex; gap: 10px;">
            <select id="year-filter"></select>
            <select id="month-filter">
                <option value="01">1æœˆ</option><option value="02">2æœˆ</option>
                <option value="03">3æœˆ</option><option value="04">4æœˆ</option>
                <option value="05">5æœˆ</option><option value="06">6æœˆ</option>
                <option value="07">7æœˆ</option><option value="08">8æœˆ</option>
                <option value="09">9æœˆ</option><option value="10">10æœˆ</option>
                <option value="11">11æœˆ</option><option value="12">12æœˆ</option>
            </select>
        </div>
        <div class="summary-grid">
            <div class="summary-item">æ”¶å…¥<div id="total-income" class="val-income">$0</div></div>
            <div class="summary-item">æ”¯å‡º<div id="total-expense" class="val-expense">$0</div></div>
            <div class="summary-item">çµé¤˜<div id="total-balance">$0</div></div>
        </div>
    </div>

    <!-- æ–°å¢ç´€éŒ„ -->
    <div class="card">
        <h2>â• æ‰‹å‹•è¨˜å¸³</h2>
        <div class="input-group">
            <select id="type">
                <option value="æ”¯å‡º">ğŸ’¸ æ”¯å‡º</option>
                <option value="æ”¶å…¥">ğŸ’° æ”¶å…¥</option>
            </select>
            <input type="date" id="date">
            <input type="text" id="desc" placeholder="é …ç›®å…§å®¹">
            <input type="number" id="amount" placeholder="é‡‘é¡">
            <button class="btn-add" onclick="addRecord()">ğŸ¶ å­˜é€²éª¨é ­ç›’</button>
        </div>
    </div>

    <!-- åœ–è¡¨ -->
    <div class="card">
        <h2>ğŸ“Š æ”¯å‡ºä½”æ¯”</h2>
        <canvas id="expenseChart" height="200"></canvas>
    </div>

    <!-- æ­·å² -->
    <div class="card full-width">
        <h2>ğŸ“œ è¨˜å¸³æ­·å²</h2>
        <div id="history" class="history-list"></div>
    </div>
</div>

<script>
    const apiKey = "";
    const STORAGE_KEY = 'smart_spend_simple_v1';
    let records = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    let chart = null;

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        const now = new Date();
        const yearSelect = document.getElementById('year-filter');
        const monthSelect = document.getElementById('month-filter');
        
        // å¡«å¯«å¹´ä»½
        for(let i=2024; i<=2026; i++) {
            yearSelect.add(new Option(i + "å¹´", i));
        }
        
        yearSelect.value = now.getFullYear();
        monthSelect.value = String(now.getMonth() + 1).padStart(2, '0');
        document.getElementById('date').value = now.toISOString().split('T')[0];

        // ç›£è½è®Šå‹•
        yearSelect.onchange = updateUI;
        monthSelect.onchange = updateUI;

        initChart();
        updateUI();
    });

    function initChart() {
        const ctx = document.getElementById('expenseChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['é¤é£²', 'äº¤é€š', 'è³¼ç‰©', 'å…¶ä»–'],
                datasets: [{ data: [0, 0, 0, 0], backgroundColor: ['#fbbf24', '#60a5fa', '#f472b6', '#cbd5e1'] }]
            }
        });
    }

    async function processAI() {
        const input = document.getElementById('ai-input').value;
        const status = document.getElementById('ai-status');
        if(!input) return;

        status.innerText = "æ±ªï¼è§£æä¸­...";
        
        try {
            const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: `è«‹è§£æè¨˜å¸³å…§å®¹ã€Œ${input}ã€ï¼Œè¼¸å‡ºç‚º JSONï¼š{"desc": "é …ç›®", "amount": æ•¸å­—, "type": "æ”¯å‡º"æˆ–"æ”¶å…¥"}` }] }],
                    generationConfig: { responseMimeType: "application/json" }
                })
            });
            const data = await resp.json();
            const result = JSON.parse(data.candidates[0].content.parts[0].text);
            
            document.getElementById('desc').value = result.desc;
            document.getElementById('amount').value = result.amount;
            document.getElementById('type').value = result.type || "æ”¯å‡º";
            status.innerText = "æ±ªï¼è§£æå¥½äº†ï¼Œè«‹é»æ“Šæ–°å¢ï¼";
        } catch(e) {
            status.innerText = "æ±ª...å¤±æ•—äº†ï¼Œè«‹æ‰‹å‹•è¼¸å…¥ã€‚";
        }
    }

    function addRecord() {
        const record = {
            id: Date.now(),
            date: document.getElementById('date').value,
            desc: document.getElementById('desc').value,
            amount: parseInt(document.getElementById('amount').value),
            type: document.getElementById('type').value
        };

        if(!record.desc || isNaN(record.amount)) return alert("è«‹å¡«å¯«å…§å®¹èˆ‡é‡‘é¡ï¼");

        records.push(record);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
        updateUI();
        
        document.getElementById('desc').value = '';
        document.getElementById('amount').value = '';
    }

    function updateUI() {
        const y = document.getElementById('year-filter').value;
        const m = document.getElementById('month-filter').value;
        const filterStr = `${y}-${m}`;
        
        const filtered = records.filter(r => r.date.startsWith(filterStr));
        const historyDiv = document.getElementById('history');
        historyDiv.innerHTML = '';
        
        let inc = 0, exp = 0;
        filtered.forEach(r => {
            if(r.type === 'æ”¶å…¥') inc += r.amount; else exp += r.amount;
            historyDiv.innerHTML += `
                <div class="history-item">
                    <span>${r.date.slice(5)} ${r.desc}</span>
                    <span class="${r.type === 'æ”¶å…¥' ? 'val-income' : 'val-expense'}">${r.type === 'æ”¶å…¥' ? '+' : '-'}${r.amount}</span>
                </div>`;
        });

        document.getElementById('total-income').innerText = `$${inc}`;
        document.getElementById('total-expense').innerText = `$${exp}`;
        document.getElementById('total-balance').innerText = `$${inc - exp}`;
        
        if(inc - exp > 1000) document.getElementById('acc-crown').classList.add('unlocked');
        
        if(chart) {
            chart.data.datasets[0].data = [exp, 0, 0, 0]; // ç°¡å–®æ¨¡æ“¬
            chart.update();
        }
    }
</script>
</body>
</html>